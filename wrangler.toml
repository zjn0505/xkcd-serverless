name = "xkcd"
main = "src/index.ts"
compatibility_date = "2025-09-15"
compatibility_flags = ["nodejs_compat"]
workers_dev = true
minify = true


[[d1_databases]]
binding = "DB"
database_name = "xkcd"
database_id = "6a0587db-9ac5-44e5-b743-4bb8d89594bf"

[[kv_namespaces]]
binding = "CRAWLER_STATE"
id = "a84f99f77872493ea14bce9d7068fafa"
preview_id = "d878eae42066419892be63ff6a6c37c1"

# Workflows
[[workflows]]
binding = "ZH_CN_CRAWLER"
name = "xkcd-zh-cn-crawler"
class_name = "ZhCnCrawlerWorkflow"

[[workflows]]
binding = "FR_CRAWLER"
name = "xkcd-fr-crawler"
class_name = "FrCrawlerWorkflow"

[[workflows]]
binding = "ZH_TW_CRAWLER"
name = "xkcd-zh-tw-crawler"
class_name = "ZhTwCrawlerWorkflow"

[[workflows]]
binding = "RU_CRAWLER"
name = "xkcd-ru-crawler"
class_name = "RuCrawlerWorkflow"

# Routes
[[routes]]
pattern = "api2.jienan.xyz/xkcd/*"
zone_name = "jienan.xyz"

# Custom domains
[[routes]]
pattern = "xkcd2.jienan.xyz"
custom_domain = true

# Cron Triggers for crawlers
[triggers]
crons = [
  "*/1 * * * *",    # Minute dispatcher: xkcd every minute; zh-CN every 15m
  "15 0 * * *"      # Daily dispatcher: What If + localized dailies
]

# [env.development]
# name = "xkcd-dev"

# [env.production]
# name = "xkcd-prod"

[observability.logs]
enabled = true